<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Chatraum</title>
  <style>
    :root{--bg:#f6f7fb;--fg:#1f2937;--brand:#2563eb;--card:#fff;--muted:#6b7280;}
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--fg)}
    header{display:flex;align-items:center;gap:12px;padding:12px 16px;background:var(--brand);color:#fff}
    header h1{margin:0;font-size:18px}
    main{display:grid;grid-template-columns:260px 1fr;gap:16px;max-width:1200px;margin:0 auto;padding:16px}
    aside,section{background:var(--card);border-radius:12px;box-shadow:0 1px 2px rgba(0,0,0,.06)}
    aside{padding:12px}
    h3{margin:6px 0 8px;font-size:14px;color:var(--muted)}
    #presenceList{list-style:none;margin:8px 0 0;padding:0;max-height:240px;overflow:auto}
    #presenceList li{padding:6px 8px;border-radius:8px;margin:4px 0;background:#f9fafb;display:flex;justify-content:space-between}
    #scoreBox{margin-top:8px;padding:10px;border-radius:10px;background:#eef2ff}
    #scoreValue{font-weight:700}
    section{display:flex;flex-direction:column;overflow:hidden}
    #roomBar{display:flex;gap:8px;padding:12px;border-bottom:1px solid #e5e7eb;align-items:center;flex-wrap:wrap}
    #chatLog{flex:1;overflow:auto;padding:12px;display:flex;flex-direction:column;gap:8px}
    .msg{padding:10px 12px;border-radius:12px;background:#f9fafb;border:1px solid #eef2f7}
    .me{background:#ecfeff;border-color:#cffafe;align-self:flex-end}
    .meta{font-size:12px;color:var(--muted);margin-bottom:4px}
    #composer{display:flex;gap:8px;padding:12px;border-top:1px solid #e5e7eb}
    #composer input[type=text]{flex:1;padding:12px;border:1px solid #e5e7eb;border-radius:12px;font-size:15px}
    #composer button{padding:12px 16px;border:0;border-radius:12px;background:var(--brand);color:#fff;font-weight:600}
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:24px;background:#111827;color:#fff;padding:10px 14px;border-radius:10px;opacity:0;transition:opacity .2s}
    .toast.show{opacity:1}
  </style>
</head>
<body>
  <header>
    <h1>Chatraum · <span id="roomName">–</span></h1>
  </header>

  <main>
    <aside>
      <h3>Profil</h3>
      <input id="nickname" type="text" placeholder="Nickname (z. B. Max)" autocomplete="off">
      <select id="roomSelect" style="margin-top:8px">
        <option value="5a">Raum 5a</option>
        <option value="5b">Raum 5b</option>
        <option value="M-Zweig">M-Zweig</option>
        <option value="Lehrerzimmer">Lehrerzimmer</option>
      </select>
      <button id="joinBtn" style="margin-top:8px">Beitreten</button>

      <h3 style="margin-top:16px;">Anwesend</h3>
      <ul id="presenceList"></ul>

      <div id="scoreBox">Score: <span id="scoreValue">0</span></div>
    </aside>

    <section>
      <div id="roomBar">
        <span style="color:var(--muted);font-size:13px">(Verstöße werden ausgeblendet, geben Punktabzug)</span>
      </div>
      <div id="chatLog" aria-live="polite"></div>
      <div id="composer">
        <input id="message" type="text" placeholder="Nachricht schreiben…" autocomplete="off" disabled>
        <button id="sendBtn" disabled>Senden</button>
      </div>
    </section>
  </main>

  <!-- Firebase SDK v9 -->
  <script type="module" src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js"></script>

  <!-- Konfiguration & Logik (wie besprochen, unverändert) -->
  <script type="module" src="./firebase-config.js"></script>
  <script type="module" src="./jc.js"></script>
  <script type="module" src="./chatroom.js"></script>

  <!-- Auto-Join aus URL-Parametern (robust + Normalisierung) -->
  <script>
    (function(){
      const qs = new URLSearchParams(window.location.search);
      const rawRoom = (qs.get('room') || '').trim();
      const nick    = (qs.get('nick') || '').trim();

      // Normalisiere Raumbezeichnungen ("Klasse 5a" → "5a", "Raum 5b" → "5b")
      function normalizeRoom(s){
        return s.replace(/^(klasse|raum)\s*/i, '').trim();
      }
      const room = normalizeRoom(rawRoom);

      const sel = document.getElementById('roomSelect');
      if (room){
        // Falls Option nicht existiert, temporär hinzufügen, damit beide Geräte denselben Wert bekommen
        let opt = Array.from(sel.options).find(o => o.value === room);
        if(!opt){
          const o = document.createElement('option');
          o.value = room; o.textContent = 'Raum ' + room;
          sel.appendChild(o);
        }
        sel.value = room;
      }
      if (nick){ document.getElementById('nickname').value = nick; }

      // Raumname im Header anzeigen
      const rn = document.getElementById('roomName');
      if (rn && room) rn.textContent = room;

      // kurze Verzögerung, dann automatisch beitreten
      setTimeout(function(){
        const btn = document.getElementById('joinBtn');
        if(btn) btn.click();
      }, 200);
    })();
  </script>
  <!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nettiquette – Raum</title>
  <style>
    :root{
      --bg:#f6f7fb; --ink:#0f1f39; --accent:#1976d2; --card:#fff;
      --muted:#6b7280; --you:#e7f8f0; --other:#eef2ff;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    header{background:var(--accent);color:#fff;text-align:center;padding:24px 14px;position:relative}
    header .logo{width:96px;height:96px;border-radius:50%;border:4px solid #fff;box-shadow:0 6px 18px rgba(0,0,0,.18);object-fit:cover;display:block;margin:0 auto 10px}
    header h1{margin:6px 0 2px;font-size:clamp(20px,3.4vw,32px)}
    header p{margin:0;opacity:.95}
    header .score{position:absolute;right:14px;top:14px;background:rgba(255,255,255,.16);padding:6px 10px;border-radius:10px;font-weight:700}
    main{max-width:980px;margin:16px auto 24px;padding:0 14px}
    .bar{display:flex;gap:10px;flex-wrap:wrap;background:var(--card);border-radius:12px;
         box-shadow:0 10px 26px rgba(0,0,0,.06);padding:12px;margin-bottom:14px}
    .pill{background:#f1f5ff;color:#243b7b;border-radius:999px;padding:8px 12px;font-weight:600}
    #messages{background:var(--card);border-radius:12px;box-shadow:0 10px 26px rgba(0,0,0,.06);
              min-height:220px;max-height:58vh;overflow:auto;padding:12px}
    .row{display:flex;margin:10px 0}
    .bubble{max-width:78%;padding:10px 12px;border-radius:12px}
    .you{background:var(--you);margin-left:auto;border-top-right-radius:0}
    .other{background:var(--other);border-top-left-radius:0}
    .meta{font-size:.85rem;color:var(--muted);margin-bottom:4px}
    .controls{display:grid;grid-template-columns:1fr auto;gap:10px;margin-top:10px}
    .controls input{padding:12px;border:1px solid #d1d5db;border-radius:10px}
    .controls button{padding:12px 14px;border:0;border-radius:10px;background:var(--accent);color:#fff;font-weight:700}
    footer{margin-top:16px}
    .author{background:var(--card);border-radius:12px;box-shadow:0 10px 26px rgba(0,0,0,.06);padding:14px;text-align:center}
    .author img{display:block;margin:10px auto 0;width:96px;height:96px;border-radius:12px;object-fit:cover;box-shadow:0 6px 18px rgba(0,0,0,.10)}
  </style>
</head>
<body>
  <header>
    <!-- Oberes Logo (Base64 oder Pfad) -->
    <img class="logo" id="logoTop" alt="Logo" />
    <h1>Nettiquette – Klassenchat</h1>
    <p>Demokratie · Soziales Handeln im Internet</p>
    <div class="score">Mein Score: <span id="myScore">0</span></div>
  </header>

  <main>
    <div class="bar">
      <div class="pill">Raum: <span id="roomLbl">–</span></div>
      <div class="pill">Nickname: <span id="nickLbl">–</span></div>
    </div>

    <section id="messages"></section>

    <div class="controls">
      <input id="chat-input" type="text" placeholder="Schreibe deine Nachricht …" />
      <button id="send-btn">Senden</button>
    </div>

    <footer>
      <div class="author">
        ✍️ Erstellt von <strong>Benjamin Hetebrüg</strong><br/>
        <a href="https://digitales.schulamt.info" target="_blank" rel="noopener">digitales.schulamt.info</a><br/>
        <a href="mailto:benjamin.hetebrueg@schulen.nuernberg.de">benjamin.hetebrueg@schulen.nuernberg.de</a>
        <!-- Unteres Logo (Base64 oder Pfad) -->
        <img id="logoBottom" alt="Logo 2" />
      </div>
    </footer>
  </main>

  <!-- HIER DEIN UNVERÄNDERTER SCRIPTBLOCK AUS room_chat.html -->
  <!-- Beispiel: deine Param-Initialisierung, Firestore/Listener, Render-Logik usw. -->
  <script>
  // Beispiel: Raum/Nick Labels setzen (belässt deine Logik unangetastet)
  const q=new URLSearchParams(location.search);
  document.getElementById('roomLbl').textContent = q.get('room') || '–';
  document.getElementById('nickLbl').textContent = q.get('nick') || '–';

  // Logos optional setzen (falls du Base64 nutzen willst, hier eintragen):
  const LOGO_TOP = "";     // z.B. "data:image/png;base64,AAAA…"
  const LOGO_BOTTOM = "";  // z.B. "data:image/png;base64,BBBB…"
  if (LOGO_TOP) document.getElementById('logoTop').src = LOGO_TOP;
  if (LOGO_BOTTOM) document.getElementById('logoBottom').src = LOGO_BOTTOM;

  // WICHTIG:
  // An dieser Stelle fügst du DEINEN kompletten, bisher funktionierenden Script-Code ein
  // (Senden, onSnapshot/Listener, Bewertung, Auto-TTL usw.) – unverändert!

  // Beispiel: vorhandenen Handler verknüpfen (damit das Layout sofort „lebt“)
  const inputEl = document.getElementById('chat-input');
  const sendBtn = document.getElementById('send-btn');
  if (typeof sendMessage === 'function') {
    sendBtn.addEventListener('click', e => { e.preventDefault(); sendMessage(e); });
    inputEl.addEventListener('keydown', e => { if(e.key==='Enter'){ e.preventDefault(); sendMessage(e); }});
  }
  </script>
</body>
</html>
  <!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nettiquette – Raum</title>
  <style>
    :root{
      --bg:#f6f7fb; --ink:#0f1f39; --accent:#1976d2; --card:#fff;
      --muted:#6b7280; --you:#e7f8f0; --other:#eef2ff;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    header{background:var(--accent);color:#fff;text-align:center;padding:24px 14px;position:relative}
    header .logo{width:96px;height:96px;border-radius:50%;border:4px solid #fff;box-shadow:0 6px 18px rgba(0,0,0,.18);object-fit:cover;display:block;margin:0 auto 10px}
    header h1{margin:6px 0 2px;font-size:clamp(20px,3.4vw,32px)}
    header p{margin:0;opacity:.95}
    header .score{position:absolute;right:14px;top:14px;background:rgba(255,255,255,.16);padding:6px 10px;border-radius:10px;font-weight:700}
    main{max-width:980px;margin:16px auto 24px;padding:0 14px}
    .bar{display:flex;gap:10px;flex-wrap:wrap;background:var(--card);border-radius:12px;
         box-shadow:0 10px 26px rgba(0,0,0,.06);padding:12px;margin-bottom:14px}
    .pill{background:#f1f5ff;color:#243b7b;border-radius:999px;padding:8px 12px;font-weight:600}
    #messages{background:var(--card);border-radius:12px;box-shadow:0 10px 26px rgba(0,0,0,.06);
              min-height:220px;max-height:58vh;overflow:auto;padding:12px}
    .row{display:flex;margin:10px 0}
    .bubble{max-width:78%;padding:10px 12px;border-radius:12px}
    .you{background:var(--you);margin-left:auto;border-top-right-radius:0}
    .other{background:var(--other);border-top-left-radius:0}
    .meta{font-size:.85rem;color:var(--muted);margin-bottom:4px}
    .controls{display:grid;grid-template-columns:1fr auto;gap:10px;margin-top:10px}
    .controls input{padding:12px;border:1px solid #d1d5db;border-radius:10px}
    .controls button{padding:12px 14px;border:0;border-radius:10px;background:var(--accent);color:#fff;font-weight:700}
    footer{margin-top:16px}
    .author{background:var(--card);border-radius:12px;box-shadow:0 10px 26px rgba(0,0,0,.06);padding:14px;text-align:center}
    .author img{display:block;margin:10px auto 0;width:96px;height:96px;border-radius:12px;object-fit:cover;box-shadow:0 6px 18px rgba(0,0,0,.10)}
  </style>
</head>
<body>
  <header>
    <!-- Oberes Logo (Base64 oder Pfad) -->
    <img class="logo" id="logoTop" alt="Logo" />
    <h1>Nettiquette – Klassenchat</h1>
    <p>Demokratie · Soziales Handeln im Internet</p>
    <div class="score">Mein Score: <span id="myScore">0</span></div>
  </header>

  <main>
    <div class="bar">
      <div class="pill">Raum: <span id="roomLbl">–</span></div>
      <div class="pill">Nickname: <span id="nickLbl">–</span></div>
    </div>

    <section id="messages"></section>

    <div class="controls">
      <input id="chat-input" type="text" placeholder="Schreibe deine Nachricht …" />
      <button id="send-btn">Senden</button>
    </div>

    <footer>
      <div class="author">
        ✍️ Erstellt von <strong>Benjamin Hetebrüg</strong><br/>
        <a href="https://digitales.schulamt.info" target="_blank" rel="noopener">digitales.schulamt.info</a><br/>
        <a href="mailto:benjamin.hetebrueg@schulen.nuernberg.de">benjamin.hetebrueg@schulen.nuernberg.de</a>
        <!-- Unteres Logo (Base64 oder Pfad) -->
        <img id="logoBottom" alt="Logo 2" />
      </div>
    </footer>
  </main>

  <!-- HIER DEIN UNVERÄNDERTER SCRIPTBLOCK AUS room_chat.html -->
  <!-- Beispiel: deine Param-Initialisierung, Firestore/Listener, Render-Logik usw. -->
  <script>
  // Beispiel: Raum/Nick Labels setzen (belässt deine Logik unangetastet)
  const q=new URLSearchParams(location.search);
  document.getElementById('roomLbl').textContent = q.get('room') || '–';
  document.getElementById('nickLbl').textContent = q.get('nick') || '–';

  // Logos optional setzen (falls du Base64 nutzen willst, hier eintragen):
  const LOGO_TOP = "";     // z.B. "data:image/png;base64,AAAA…"
  const LOGO_BOTTOM = "";  // z.B. "data:image/png;base64,BBBB…"
  if (LOGO_TOP) document.getElementById('logoTop').src = LOGO_TOP;
  if (LOGO_BOTTOM) document.getElementById('logoBottom').src = LOGO_BOTTOM;

  // WICHTIG:
  // An dieser Stelle fügst du DEINEN kompletten, bisher funktionierenden Script-Code ein
  // (Senden, onSnapshot/Listener, Bewertung, Auto-TTL usw.) – unverändert!

  // Beispiel: vorhandenen Handler verknüpfen (damit das Layout sofort „lebt“)
  const inputEl = document.getElementById('chat-input');
  const sendBtn = document.getElementById('send-btn');
  if (typeof sendMessage === 'function') {
    sendBtn.addEventListener('click', e => { e.preventDefault(); sendMessage(e); });
    inputEl.addEventListener('keydown', e => { if(e.key==='Enter'){ e.preventDefault(); sendMessage(e); }});
  }
  </script>
</body>
</html>
</body>
</html>
